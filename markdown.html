<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ALPHA MODEL MARKDOWN EDITOR (v1.3.0)</title>
  <style>
    :root {
      --left-pane: 50%;
      --handle-w: 8px;
      --bg: #f7f8fb;
      --fg: #1f2937;
      --muted: #6b7280;
      --brand: #4f46e5;
      --card: #ffffff;
      --border: #e5e7eb;
      --toolbar-h: 52px; /* synced with left toolbar */
    }
    body.dark { 
      --bg:#0f172a; 
      --fg:#e5e7eb; 
      --muted:#9ca3af; 
      --brand:#8b5cf6; 
      --card:#0b1220; 
      --border:#334155; 
    }

    *{ box-sizing: border-box; }
    html, body{ height:100%; }
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      -webkit-font-smoothing: antialiased;
    }

    header{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 16px; color:#fff;
      background: linear-gradient(90deg, var(--brand), #7c3aed);
    }
    header .title{ font-weight:700; letter-spacing:.2px; }

    .topbar{
      display:flex; align-items:center; gap:8px;
      padding:10px 12px; background:var(--card);
      border-bottom:1px solid var(--border);
      position:relative; z-index: 6;
    }
    .seg{ display:inline-flex; border:1px solid var(--border); border-radius:10px; overflow:hidden; }
    .seg button{
      border:0; background:transparent; padding:6px 12px; font-size:14px; cursor:pointer; color:var(--muted);
    }
    .seg button.active{ background:var(--brand); color:#fff; }

    .btn{ border:1px solid var(--border); background:var(--card); color:var(--fg); padding:6px 10px; border-radius:8px; cursor:pointer; font-size:14px; }
    .btn:hover{ background:rgba(0,0,0,.04); }
    body.dark .btn:hover{ background:rgba(255,255,255,.06); }
    .spacer{ flex:1; }

    .container{ height: calc(100vh - 144px); display:grid; grid-template-columns: var(--left-pane) var(--handle-w) 1fr; }

    /* left editor */
    #editorPane{ display:flex; flex-direction:column; overflow:hidden; border-right:1px solid var(--border); background:var(--card); }
    .editor-toolbar{
      position:sticky; top:0; z-index:5; min-height:var(--toolbar-h);
      display:flex; flex-wrap:wrap; gap:8px; align-items:center; padding:8px 10px;
      background:var(--card); border-bottom:1px solid var(--border);
    }
    .editor-toolbar .sep{ width:1px; height:24px; background:var(--border); margin:0 4px; }
    .editor-toolbar button, .editor-toolbar select{
      border:1px solid var(--border); background:var(--card); color:var(--fg);
      padding:6px 8px; border-radius:8px; cursor:pointer; font-size:13px;
    }
    .editor-toolbar button:hover{ background:rgba(0,0,0,.04); }
    body.dark .editor-toolbar button:hover{ background:rgba(255,255,255,.06); }

    #markdownInput{
      width:100%; height:100%; border:0; outline:none; resize:none;
      padding:14px 16px 64px; background:var(--card); color:var(--fg);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New";
      font-size:14px; line-height:1.6; tab-size:2;
    }

    .resize-handle{ width:var(--handle-w); cursor: col-resize; background: repeating-linear-gradient(90deg, var(--border), var(--border) 1px, transparent 1px, transparent 4px); }

    /* right preview */
    #htmlPreview{ background:var(--card); overflow:auto; position:relative; }
    .preview-toolbar{ position:sticky; top:0; z-index:5; min-height:var(--toolbar-h); display:flex; align-items:center; justify-content:flex-end; gap:8px; padding:8px 10px; background:var(--card); border-bottom:1px solid var(--border); }
    #previewContent{ padding: 20px 28px 64px; }

    /* markdown styling */
    #previewContent :where(h1,h2,h3,h4,h5,h6){ border-bottom:1px solid var(--border); padding-bottom:.3em; }
    #previewContent h1{ font-size:1.8rem; }
    #previewContent h2{ font-size:1.5rem; }
    #previewContent h3{ font-size:1.25rem; }
    #previewContent pre{ background:rgba(127,127,127,.1); padding:12px; border-radius:8px; overflow:auto; }
    #previewContent code{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New"; }
    #previewContent blockquote{ margin:0; border-left:4px solid var(--border); padding:6px 12px; color:var(--muted); }
    #previewContent table{ border-collapse:collapse; width:100%; }
    #previewContent th, #previewContent td{ border:1px solid var(--border); padding:8px; text-align:left; }
    #previewContent a{ color:#2563eb; }

    .status{ position:fixed; left:12px; bottom:8px; font-size:12px; color:var(--muted); display:flex; gap:12px; }

    /* modes */
    .mode-edit .container{ grid-template-columns: 1fr; }
    .mode-edit .resize-handle, .mode-edit #htmlPreview{ display:none; }
    .mode-preview .container{ grid-template-columns: 1fr; }
    .mode-preview .resize-handle, .mode-preview #editorPane{ display:none; }

    /* menu */
    .menu{ position:relative; }
    .dropdown{ position:absolute; right:0; top:40px; background:var(--card); border:1px solid var(--border); border-radius:10px; min-width:220px; box-shadow:0 10px 30px rgba(0,0,0,.18); display:none; z-index:10; }
    .dropdown .item, .dropdown label{ width:100%; display:flex; gap:8px; align-items:center; justify-content:space-between; padding:8px 10px; border:0; background:transparent; cursor:pointer; font-size:14px; color:var(--fg); }
    .dropdown .item:hover{ background:rgba(0,0,0,.05); }
    body.dark .dropdown .item:hover{ background:rgba(255,255,255,.06); }

    @media print{
      header, .topbar, .status, #editorPane, .resize-handle, .preview-toolbar { display:none !important; }
      .container{ grid-template-columns: 1fr !important; }
      #htmlPreview{ display:block !important; }
      #previewContent{ padding:0 !important; }
    }
  </style>
</head>
<body class="mode-split">
  <header>
    <div class="title">ALPHA MODEL MARKDOWN EDITOR <small>(v1.3.0)</small></div>
    <div class="seg" role="tablist" aria-label="„Éì„É•„ÉºÂàáÊõø">
      <button id="modeEdit" class="active" role="tab" aria-selected="true">Á∑®ÈõÜ</button>
      <button id="modeSplit" role="tab" aria-selected="false">ÂàÜÂâ≤</button>
      <button id="modePreview" role="tab" aria-selected="false">„Éó„É¨„Éì„É•„Éº</button>
    </div>
  </header>

  <div class="topbar">
    <button id="openBtn" class="btn">Èñã„Åè</button>
    <button id="saveBtn" class="btn" title="Markdown„ÅÆ„Åø‰øùÂ≠ò (‚åò/Ctrl+S)">‰øùÂ≠ò</button>
    <div class="spacer"></div>
    <button id="themeBtn" class="btn" title="„ÉÜ„Éº„ÉûÂàáÊõø">üåì</button>
    <div class="menu">
      <button id="menuBtn" class="btn" aria-haspopup="true" aria-expanded="false">‚ãÆ</button>
      <div id="menuDropdown" class="dropdown" role="menu">
        <button class="item" id="newDoc" role="menuitem">Êñ∞Ë¶è</button>
        <button class="item" id="saveMD" role="menuitem">MD„ÅÆ„Åø‰øùÂ≠ò</button>
        <button class="item" id="saveHTML" role="menuitem">HTML„ÅÆ„Åø‰øùÂ≠ò</button>
        <button class="item" id="saveBoth" role="menuitem">MD+HTML‰øùÂ≠ò</button>
        <button class="item" id="copyMD" role="menuitem">MD„Çí„Ç≥„Éî„Éº</button>
        <button class="item" id="copyHTML" role="menuitem">HTML„Çí„Ç≥„Éî„Éº</button>
        <label class="item" title="MarkdownÂÜÖ„ÅÆÁîüHTML„ÇíÁÑ°ÂäπÂåñ">
          <span>„Çµ„Éã„Çø„Ç§„Ç∫ÔºàÊé®Â•®Ôºâ</span>
          <input type="checkbox" id="sanitizeHtml" checked />
        </label>
        <label class="item" title="„Ç®„Éá„Ç£„Çø„Å®„Éó„É¨„Éì„É•„Éº„ÇíÂêåÊúü„Çπ„ÇØ„É≠„Éº„É´">
          <span>„Çπ„ÇØ„É≠„Éº„É´ÂêåÊúü</span>
          <input type="checkbox" id="scrollSync" checked />
        </label>
      </div>
    </div>
    <input type="file" id="loadFile" accept=".md" style="display:none" />
  </div>

  <div class="container">
    <!-- Left / Editor -->
    <section id="editorPane" aria-label="„Ç®„Éá„Ç£„Çø">
      <div class="editor-toolbar" aria-label="Êõ∏Âºè„Å®„ÉÜ„É≥„Éó„É¨„Éº„Éà">
        <button data-act="bold" title="Â§™Â≠ó (‚åò/Ctrl+B)"><b>B</b></button>
        <button data-act="italic" title="Êñú‰Ωì (‚åò/Ctrl+I)"><i>I</i></button>
        <button data-act="h1" title="Ë¶ãÂá∫„Åó1">H1</button>
        <button data-act="h2" title="Ë¶ãÂá∫„Åó2">H2</button>
        <button data-act="link" title="„É™„É≥„ÇØ">üîó</button>
        <button data-act="ul" title="ÁÆáÊù°Êõ∏„Åç">‚Ä¢ List</button>
        <button data-act="ol" title="Áï™Âè∑„É™„Çπ„Éà">1. List</button>
        <button data-act="code" title="„Ç≥„Éº„Éâ (‚åò/Ctrl+E)">```</button>
        <span class="sep" aria-hidden="true"></span>
        <select id="templateSelect" title="„ÉÜ„É≥„Éó„É¨„Éº„Éà">
          <option value="">„ÉÜ„É≥„Éó„É¨„Éº„Éà‚Ä¶</option>
          <option value="minutes">‰ºöË≠∞„É°„É¢</option>
          <option value="readme">README</option>
          <option value="check">„ÉÅ„Çß„ÉÉ„ÇØ„É™„Çπ„Éà</option>
          <option value="table">Ë°®„ÅÆ„Å≤„Å™Âûã</option>
          <option value="m_flow">Mermaid: „Éï„É≠„Éº„ÉÅ„É£„Éº„Éà</option>
          <option value="m_seq">Mermaid: „Ç∑„Éº„Ç±„É≥„ÇπÂõ≥</option>
          <option value="toc">ÁõÆÊ¨° [TOC]</option>
        </select>
        <button id="insertTemplate">ÊåøÂÖ•</button>
      </div>
      <textarea id="markdownInput" placeholder="„Åì„Åì„Å´Markdown„ÇíÂÖ•Âäõ"></textarea>
    </section>

    <div class="resize-handle" role="separator" aria-orientation="vertical" aria-label="„É™„Çµ„Ç§„Ç∫"></div>

    <!-- Right / Preview -->
    <section id="htmlPreview" class="preview" aria-label="„Éó„É¨„Éì„É•„Éº">
      <div id="previewToolbar" class="preview-toolbar">
        <button id="printBtn" class="btn" title="„Éó„É¨„Éì„É•„Éº„ÇíÂç∞Âà∑ / PDF ‰øùÂ≠ò">üñ®Ô∏è Âç∞Âà∑</button>
      </div>
      <div id="previewContent"></div>
    </section>
  </div>

  <div class="status">
    <span id="statLines">0 Ë°å</span>
    <span id="statWords">0 Ë™û</span>
    <span id="statSaved">Êú™‰øùÂ≠ò</span>
  </div>

  <!-- Offline dependencies -->
  <script src="./marked.min.js"></script>
  <script src="./mermaid.min.js"></script>

  <script>
  (function(){
    const $ = (s,el=document)=>el.querySelector(s);
    const $$ = (s,el=document)=>Array.from(el.querySelectorAll(s));

    const mdInput = $('#markdownInput');
    const preview = $('#htmlPreview');
    const previewToolbar = $('#previewToolbar');
    const previewContent = $('#previewContent');
    const editorPane = $('#editorPane');
    const container = $('.container');
    const handle = $('.resize-handle');

    const statLines = $('#statLines');
    const statWords = $('#statWords');
    const statSaved = $('#statSaved');

    const sanitizeChk = $('#sanitizeHtml');
    const scrollSyncChk = $('#scrollSync');

    const LS_LEFT = 'sme-leftwidth';
    const LS_THEME = 'sme-theme';

    // Theme
    function setTheme(mode){ document.body.classList.toggle('dark', mode==='dark'); try{localStorage.setItem(LS_THEME, mode);}catch{} }
    $('#themeBtn').addEventListener('click', ()=> setTheme(document.body.classList.contains('dark') ? 'light':'dark'));
    try{ setTheme(localStorage.getItem(LS_THEME)||'light'); }catch{}

    // Mermaid
    try{ mermaid.initialize({ startOnLoad:false }); }catch(e){ console.warn('Mermaid init failed',e); }

    // Marked
    const renderer = new marked.Renderer();
    function applySanitize(on){ renderer.html = on ? function(){ return ''; } : undefined; }
    applySanitize(true);
    marked.setOptions({ gfm:true, breaks:false, mangle:false, headerIds:true, renderer });

    function updateCounts(){
      const v = mdInput.value; statLines.textContent = (v? v.split(/\n/).length:0) + ' Ë°å'; statWords.textContent = (v.trim()? v.trim().split(/\s+/).length:0) + ' Ë™û';
    }

    function renderMermaid(){
      // Convert fenced mermaid ‚Üí div.mermaid
      previewContent.innerHTML = previewContent.innerHTML.replace(/<pre><code class="language-mermaid">([\s\S]*?)<\/code><\/pre>/g,
        (_,code)=>`<div class="mermaid">${code.replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&')}</div>`);
      try{ const nodes=$$('.mermaid', previewContent); if(nodes.length){ mermaid.init(undefined, nodes); } }catch(err){ console.error('Mermaid rendering error:', err); }
    }

    let raf=0; function render(){
      if(raf) cancelAnimationFrame(raf);
      raf = requestAnimationFrame(()=>{
        try {
          const md = mdInput.value;
          previewContent.innerHTML = marked.parse(md);
          renderMermaid();
          updateCounts();
          syncToolbarHeights();
        } catch(err){
          previewContent.innerHTML = '<pre>„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Ç®„É©„Éº: ' + String(err) + '</pre>';
        }
      });
    }
    // ‚Üê render() Èñ¢Êï∞„ÅÆÂÆöÁæ©Âæå or ÂàùÊúüÂåñ„Éñ„É≠„ÉÉ„ÇØ„ÅÆ„Å©„Åì„Åã„Åß
    mdInput.addEventListener('input', render);          // „Çø„Ç§„Éó„ÅÆ„Åü„Å≥„Å´„Éó„É¨„Éì„É•„ÉºÊõ¥Êñ∞ÔºàÂøÖÈ†àÔºâ
    mdInput.addEventListener('compositionend', render); // Êó•Êú¨Ë™ûIMEÁ¢∫ÂÆöÊôÇ„Å´„ÇÇÁ¢∫ÂÆü„Å´Êõ¥Êñ∞ÔºàÊé®Â•®Ôºâ
    mdInput.addEventListener('paste', () => requestAnimationFrame(render)); // Ë≤º„Çä‰ªò„ÅëÁõ¥Âæå„Å´Êõ¥Êñ∞ÔºàÊé®Â•®Ôºâ


    // Sync toolbar heights: right toolbar matches left toolbar height
    function syncToolbarHeights(){
      const tb = document.querySelector('.editor-toolbar');
      const h = tb ? Math.ceil(tb.getBoundingClientRect().height) : 44;
      document.documentElement.style.setProperty('--toolbar-h', h + 'px');
      if(previewToolbar) previewToolbar.style.minHeight = h + 'px';
    }
    window.addEventListener('resize', syncToolbarHeights);

    // Modes
    const seg = { edit: $('#modeEdit'), split: $('#modeSplit'), prev: $('#modePreview') };
    function setMode(mode){
      document.body.classList.remove('mode-edit','mode-split','mode-preview');
      if(mode==='edit'){ document.body.classList.add('mode-edit'); activate(seg.edit); }
      else if(mode==='preview'){ document.body.classList.add('mode-preview'); activate(seg.prev); }
      else { document.body.classList.add('mode-split'); activate(seg.split); }
      syncToolbarHeights();
    }
    function activate(btn){
      [seg.edit, seg.split, seg.prev].forEach(b=>{ b.classList.remove('active'); b.setAttribute('aria-selected','false'); });
      btn.classList.add('active'); btn.setAttribute('aria-selected','true');
    }
    seg.edit.addEventListener('click', ()=> setMode('edit'));
    seg.split.addEventListener('click', ()=> setMode('split'));
    seg.prev.addEventListener('click', ()=> setMode('preview'));
    setMode('split');

    // Resize handle (persistent width)
    let drag=null; handle.addEventListener('mousedown',e=>{ drag={x:e.clientX, w: editorPane.getBoundingClientRect().width}; document.body.style.userSelect='none'; });
    window.addEventListener('mousemove',e=>{ if(!drag) return; const dx=e.clientX-drag.x; const cw=container.getBoundingClientRect().width; const minL=240, minR=280; let w=Math.max(minL, Math.min(drag.w+dx, cw-minR)); document.documentElement.style.setProperty('--left-pane', w+'px'); try{localStorage.setItem(LS_LEFT,String(w));}catch{} });
    window.addEventListener('mouseup',()=>{ drag=null; document.body.style.userSelect=''; });
    handle.addEventListener('dblclick',()=>{ document.documentElement.style.setProperty('--left-pane','50%'); try{localStorage.setItem(LS_LEFT,'50%');}catch{} });
    try{ const left=localStorage.getItem(LS_LEFT); if(left) document.documentElement.style.setProperty('--left-pane', left.match(/%|px/)? left : left+'px'); }catch{}

    // File open/save/copy
    function filenameFromDoc(){ const m=mdInput.value.match(/^\s*#\s+(.+)$/m); const title=m?m[1].trim():'document'; const dt=new Date(); const p=[dt.getFullYear(), String(dt.getMonth()+1).padStart(2,'0'), String(dt.getDate()).padStart(2,'0')].join(''); return title.toLowerCase().replace(/[^a-z0-9\u3040-\u30ff\u4e00-\u9faf\s-]/g,'').trim().replace(/\s+/g,'-')+'_'+p; }
    function saveBlob(text, type, name){ const b=new Blob([text],{type}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download=name; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(a.href); statSaved.textContent='‰øùÂ≠ò„Åó„Åæ„Åó„Åü'; }
    function getWrappedHTML(){ const inner=previewContent.innerHTML; const css=`body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;max-width:860px;margin:40px auto;padding:0 24px;color:#111;background:#fff} .preview :where(h1,h2,h3,h4,h5,h6){border-bottom:1px solid #e5e7eb;padding-bottom:.3em} pre{background:#f5f5f7;padding:12px;border-radius:8px;overflow:auto} code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,\"Liberation Mono\",\"Courier New\"} blockquote{margin:0;border-left:4px solid #e5e7eb;padding:6px 12px;color:#555} table{border-collapse:collapse;width:100%} th,td{border:1px solid #e5e7eb;padding:8px;text-align:left}`; return `<!DOCTYPE html><html lang=\"ja\"><head><meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><title>${document.title.replace(/</g,'&lt;')}</title><style>${css}</style></head><body class=\"preview\">${inner}</body></html>`; }

    $('#openBtn').addEventListener('click', ()=> $('#loadFile').click());
    $('#loadFile').addEventListener('change', (e)=>{ const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=ev=>{ mdInput.value=ev.target.result; render(); }; r.readAsText(f); e.target.value=''; statSaved.textContent='Êú™‰øùÂ≠ò'; });

    function saveMD(){ saveBlob(mdInput.value,'text/markdown', filenameFromDoc()+'.md'); }
    function saveHTML(){ saveBlob(getWrappedHTML(),'text/html', filenameFromDoc()+'.html'); }
    function saveBoth(){ saveMD(); saveHTML(); }

    $('#saveBtn').addEventListener('click', saveMD);
    $('#saveMD').addEventListener('click', saveMD);
    $('#saveHTML').addEventListener('click', saveHTML);
    $('#saveBoth').addEventListener('click', saveBoth);

    $('#copyMD').addEventListener('click', ()=> navigator.clipboard.writeText(mdInput.value));
    $('#copyHTML').addEventListener('click', ()=> navigator.clipboard.writeText(getWrappedHTML()));

    $('#newDoc').addEventListener('click', ()=>{ if(confirm('ÂÜÖÂÆπ„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü')){ mdInput.value=''; render(); statSaved.textContent='Êú™‰øùÂ≠ò'; }});

    // Menu toggle
    const menuBtn=$('#menuBtn'), menu=$('#menuDropdown');
    menuBtn.addEventListener('click', ()=>{ const open=menu.style.display==='block'; menu.style.display=open?'none':'block'; menuBtn.setAttribute('aria-expanded', String(!open)); });
    document.addEventListener('click', (e)=>{ if(!menu.contains(e.target) && e.target!==menuBtn) menu.style.display='none'; });

    // Toggles
    sanitizeChk.addEventListener('change', ()=>{ applySanitize(sanitizeChk.checked); render(); });

    // Scroll sync (split mode only)
    let syncing = null; // 'editor' | 'preview' | null
    function syncFromEditor(){
      if(!(scrollSyncChk && scrollSyncChk.checked)) return;
      if(document.body.classList.contains('mode-edit') || document.body.classList.contains('mode-preview')) return;
      if(syncing==='preview') return; syncing='editor';
      const ratio = mdInput.scrollTop / ((mdInput.scrollHeight - mdInput.clientHeight) || 1);
      preview.scrollTop = ratio * (preview.scrollHeight - preview.clientHeight);
      syncing=null;
    }
    function syncFromPreview(){
      if(!(scrollSyncChk && scrollSyncChk.checked)) return;
      if(document.body.classList.contains('mode-edit') || document.body.classList.contains('mode-preview')) return;
      if(syncing==='editor') return; syncing='preview';
      const ratio = preview.scrollTop / ((preview.scrollHeight - preview.clientHeight) || 1);
      mdInput.scrollTop = ratio * (mdInput.scrollHeight - mdInput.clientHeight);
      syncing=null;
    }
    mdInput.addEventListener('scroll', syncFromEditor);
    preview.addEventListener('scroll', syncFromPreview);

    // Formatting & templates
    function wrapSelection(before, after = before, placeholder = ''){
      const el = mdInput; el.focus(); const s=el.selectionStart, e=el.selectionEnd; const sel=el.value.slice(s,e) || placeholder; el.setRangeText(before+sel+after, s, e, 'end'); render(); }
    function insertBlock(text){ const el=mdInput; el.focus(); const s=el.selectionStart; const pre=el.value.slice(0,s); const suf=el.value.slice(s); const needNL = pre && !pre.endsWith('\n'); const ins=(needNL?'\n':'')+text+(text.endsWith('\n')?'':'\n'); el.value = pre + ins + suf; el.selectionStart = el.selectionEnd = (pre + ins).length; render(); }

    const TPL={
      minutes:`# ‰ºöË≠∞„É°„É¢\n- Êó•ÊôÇ: ${new Date().toLocaleString()}\n- Âá∫Â∏≠: \n\n## Ê±∫ÂÆö‰∫ãÈ†Ö\n- \n\n## „Ç¢„ÇØ„Ç∑„Éß„É≥\n- [ ] ÊãÖÂΩì: ÊúüÈôê: ÂÜÖÂÆπ:\n`,
      readme:`# „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÂêç\nÁ∞°Âçò„Å™Ë™¨Êòé‚Ä¶\n\n## ‰Ωø„ÅÑÊñπ\n\n\`\`\`bash\n# ‰æã\n\`\`\`\n`,
      check:`# „ÉÅ„Çß„ÉÉ„ÇØ„É™„Çπ„Éà\n- [ ] È†ÖÁõÆ1\n- [ ] È†ÖÁõÆ2\n`,
      table:`| È†ÖÁõÆ | ÂÄ§ | ÂÇôËÄÉ |\n|---|---:|---|\n| A | 0 |  |\n| B | 0 |  |\n`,
      m_flow:`\n\`\`\`mermaid\ngraph TD\n  A[Start] --> B{Decision}\n  B -->|Yes| C[End]\n  B -->|No| D[Else]\n\n\`\`\`\n`,
      m_seq:`\n\`\`\`mermaid\nsequenceDiagram\n  participant „É¶„Éº„Ç∂„Éº\n  participant „Ç∑„Çπ„ÉÜ„É†\n  „É¶„Éº„Ç∂„Éº->>„Ç∑„Çπ„ÉÜ„É†: „É™„ÇØ„Ç®„Çπ„Éà\n  „Ç∑„Çπ„ÉÜ„É†-->>„É¶„Éº„Ç∂„Éº: „É¨„Çπ„Éù„É≥„Çπ\n\n\`\`\`\n`,
      toc:`[TOC]\n\n`
    };

    $('.editor-toolbar').addEventListener('click', (e)=>{
      const act = e.target.getAttribute('data-act'); if(!act) return;
      if(act==='bold') return wrapSelection('**','**','Â§™Â≠ó');
      if(act==='italic') return wrapSelection('*','*','Êñú‰Ωì');
      if(act==='h1') return insertBlock('\n# Ë¶ãÂá∫„Åó\n');
      if(act==='h2') return insertBlock('\n## Ë¶ãÂá∫„Åó\n');
      if(act==='link') return wrapSelection('[','](https://)','„ÉÜ„Ç≠„Çπ„Éà');
      if(act==='ul') return insertBlock('- È†ÖÁõÆ\n- È†ÖÁõÆ\n- È†ÖÁõÆ\n');
      if(act==='ol') return insertBlock('1. È†ÖÁõÆ\n2. È†ÖÁõÆ\n3. È†ÖÁõÆ\n');
      if(act==='code') return insertBlock('\n```\ncode\n```\n');
    });

    $('#insertTemplate').addEventListener('click', ()=>{ const key=$('#templateSelect').value; if(!key) return; insertBlock(TPL[key]||''); $('#templateSelect').value=''; });

    // Shortcuts
    document.addEventListener('keydown', (e)=>{
      const meta = e.ctrlKey || e.metaKey;
      if(meta && e.key.toLowerCase()==='s'){ e.preventDefault(); saveMD(); }
      if(meta && e.key.toLowerCase()==='o'){ e.preventDefault(); $('#loadFile').click(); }
      if(meta && e.key.toLowerCase()==='b'){ e.preventDefault(); wrapSelection('**','**','Â§™Â≠ó'); }
      if(meta && e.key.toLowerCase()==='i'){ e.preventDefault(); wrapSelection('*','*','Êñú‰Ωì'); }
      if(meta && e.key.toLowerCase()==='e'){ e.preventDefault(); insertBlock('\n```\ncode\n```\n'); }
    });

    // Print (always preview only)
    $('#printBtn').addEventListener('click', ()=> window.print());

    // Initial
    syncToolbarHeights();
    render();
  })();
  </script>
</body>
</html>
